<html xml:lang="en" lang="en">
<head>
<style>
  body {
    /* padding: 100px; */
    width: 1200px;
    margin: auto;
    text-align: left;
    font-weight: 300;
    font-family: 'Open Sans', sans-serif;
    color: #121212;
  }
  h4 {
    font-size: 35;
    font-family: 'Source Sans Pro', sans-serif;
  }
  h3 {
    font-family: 'Source Sans Pro', sans-serif;
    font-size: 30;
  }
  h2 {
      font-size: 45;
      font-family: 'Source Sans Pro', sans-serif;
  }
  h1 {
      font-family: 'Source Sans Pro', sans-serif;
      background: gray;
      color: white;
      padding: 70px;
  }
  p{
      font-size: 20;
  }
  figcaption {
      font-size: large;
  }
  h5 {
    font-size: 20;
  }
</style>
</head>
<title>Zixian Zang Frequency Project</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link href="https://fonts.googleapis.com/css?family=Open+Sans|Source+Sans+Pro" rel="stylesheet">


<body>

    <h1 align="middle">
        CS194-26: Image Manipulation and Computational Photography <br>Sping 2020 
        <br>Project 3:Face Morphing <br>Zixian Zang, CS194-26-act
    </h1>

    <h2 align="middle">Overview</h2align="middle">
    <br>

    <h5>In this assignment I produce a "morph" animation of one face into another face, mean face
    of a particular population, and manipulate my face's vector base on the theory that faces
    forms basis and transform of features can be represented as vector between faces.

        To accomplish this, I first label the correspondence, mapping eyes to eyes, mouth to mouth, 
    chin to chin, ears to ears, etc., to get the smoothest transformations possible.
        
        Then with the correspondences positions, I use Delaunay Triangulation algorithm to determine
    triangular partitions of the images. With the positions of corners of triangles, I treat the transformations
    of triangle areas as trasformations of basis. The transformation matrices can be solved with linear equations.
    Then I map the pixel values, with specific weights, together onto the resulting image. This operation
    can produce a pretty decent mid-way face result.</h5>

    <h2 align="middle">
        Part 1: Defining Correspondences
    </h2>

    <h4 align="middle">
        Section 1.1: Label & Record Correspondences
    </h4>

    <p>With the help of <strong>ginput</strong> in pyplot, I manage to first get the positions of 
        correspondences. The order of the correspondences is shown in the example image below.
    </p>
    <div align="middle">
        <table>
            <tr>
                <td>
                    <figcaption align="middle">Labeling Order</figcaption>
                    <img src="label_order.jpg" align="middle" width="340px"/>
                </td>
                <td>
                    <figcaption align="middle">Produced Points</figcaption>
                    <img src="george_dot.jpg" align="middle" width="340px"/>
                </td>
            </tr>
        </table>
    </div>

    <h2 align="middle">
        Part 2: Computing the "Mid-way Face"
    </h2>

    <p>First I compute the "mid-way" shape, the position of the correspondences, by simply adding the 
        correspondences of image A and image B. MidShape = weight * ShapeA + (1 - weight) * ShapeB, where
        weight is a uniform slicing from 0 to 1.
    </p>

    <p>Then I compute the trigular partition of "mid-way" shape with Delaunay Triangulation.
    </p>
    <div align="middle">
        <table>
            <tr>
                <td>
                    <figcaption align="middle">Image 1 Partition</figcaption>
                    <img src="zzx_line.png" align="middle" height="400px"/>
                </td>
                <td>
                    <figcaption align="middle">Image 2 Partition</figcaption>
                    <img src="george_line.jpg" align="middle" height="400px"/>
                </td>
                <td>
                    <figcaption align="middle">MeanShape Partition Example</figcaption>
                    <img src="meanshape.png" align="middle" height="400px"/>
                </td>
            </tr>
        </table>
    </div>
    <p>To get the transform rule of the image partitions, I use equation of Affine transformation,
        since triangle transformations obey affine transformation.
        Consider the example below
    </p>
    <div align="middle">
        <table>
            <tr>
                <td>
                    <figcaption align="middle">Tri1 -> Tri2</figcaption>
                    <img src="equation.PNG" align="middle" width="700px"/>
                </td>
            </tr>
        </table>
    </div>
    <p>With the rule of Affine transformation, we know that the coordinates of the corresponding points
        in the two triangles obey the following equations.
    </p>
    <div align="middle">
        <table>
            <tr>
                <td>
                    <figcaption align="middle">Affine Transform</figcaption>
                    <img src="equation2.jpg" align="middle" width="600px"/>
                </td>
            </tr>
        </table>
    </div>
    <p>To solve this system of equations, I construct the following matrix linear equation, and with np.linalg.lstsq,
        I solve for the unknowns in the transform matrix, a-f.
    </p>
    <div align="middle">
        <table>
            <tr>
                <td>
                    <figcaption align="middle">Linear Equation</figcaption>
                    <img src="equation3.PNG" align="middle" width="600px"/>
                </td>
            </tr>
        </table>
    </div>
    <p>With these information about the transformation, I can simply multiply a pixel's position with the 
        transformation matrix gives us the destination position of that pixel on the final image. </p>
    <p>Here is the face of me and George Clooney, as well as our mid-face.</p>
    <div align="middle">
        <table>
            <tr>
                <td>
                    <figcaption align="middle">Zixian Zang</figcaption>
                    <img src="zzx.jpg" align="middle" width="400px"/>
                </td>
            
                <td>
                    <figcaption align="middle">Mid Face</figcaption>
                    <img src="midface.jpg" align="middle" width="400px"/>
                </td>
                <td>
                    <figcaption align="middle">George Clooney</figcaption>
                    <img src="george.jpg" align="middle" width="400px" height="534px"/>
                </td>
            </tr>
        </table>
    </div>
    <br><br>

    <h2 align="middle">
        Part 3: The Morph Sequence
    </h2>

    <p>I write a function that produces a warp between im1 and im2 using point correspondences 
        defined in im1_pts and im2_pts (which are both n-by-2 matrices of (x,y) locations) and 
        the triangulation structure tri . The parameters warp_frac and dissolve_frac control shape 
        warping and cross-dissolve, respectively. In particular, images im1 and im2 are first warped 
        into an intermediate shape configuration controlled by warp_frac, and then cross-dissolved 
        according to dissolve_frac. For interpolation, both parameters lie in the range [0,1]. They 
        are the only parameters that will vary from frame to frame in the animation.</p>

    <div align="middle">
        <table>
            <tr>
                <td>
                    <figcaption align="middle">Example 1</figcaption>
                    <img src="zzxgeorge.gif" align="middle" height="500px"/>
                </td>
                <td>
                    <figcaption align="middle">Example 2</figcaption>
                    <img src="johnhil.gif" align="middle" height="500px"/>
                </td>
            </tr>
        </table>
    </div>

    <br><br>
    <h2 align="middle">
        Part 4: The "Mean face" of a Population
    </h2>

    <p>I use images of all current faculty member of BAIR (The Berkeley Artificial Intelligence Research Lab).
    </p>
    <p>Faculty list link:https://bair.berkeley.edu/faculty.html</p>
    <h4 align="middle">Dataset</h4>
    <div align="middle">
        <table>
            <tr>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR0.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR1.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR2.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR3.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR4.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR5.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR6.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR7.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR8.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR9.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR10.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR11.jpg" align="middle" height="100px"/>
                </td>
            </tr>
        </table>
    </div>
    <div align="middle">
        <table>
            <tr>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR12.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR13.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR14.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR15.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR16.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR17.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR18.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR19.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR20.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR21.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR22.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR23.jpg" align="middle" height="100px"/>
                </td>
            </tr>
        </table>
    </div>
    <div align="middle">
        <table>
            <tr>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR24.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR25.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR26.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR27.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR28.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR29.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR30.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR31.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR32.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR33.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR34.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR35.jpg" align="middle" height="100px"/>
                </td>
            </tr>
        </table>
    </div>
    <div align="middle">
        <table>
            <tr>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR36.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR37.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR38.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR39.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR40.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR41.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR42.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR43.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR44.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR45.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR46.jpg" align="middle" height="100px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="Baircut/BAIR47.jpg" align="middle" height="100px"/>
                </td>
            </tr>
        </table>
    </div>

    <h4 align="middle">"Mean Face" of BAIR Faculties</h4>
    <div align="middle">
        <table>
            <tr>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="bairMean.jpg" align="middle" height="500px"/>
                </td>
            </tr>
        </table>
    </div>
    <h4 align="middle">Morph BAIR Faces Into Meanshape</h4>
    <div align="middle">
        <table>
            <tr>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="bair6_to_bair_meanalpha1.jpg" align="middle" height="300px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="bair4_to_bair_meanalpha1.jpg" align="middle" height="300px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="bair12_to_bair_meanalpha1.jpg" align="middle" height="300px"/>
                </td>
            </tr>
        </table>
    </div>
    <div align="middle">
        <table>
            <tr>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="bair18_to_bair_meanalpha1.jpg" align="middle" height="300px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="bair19_to_bair_meanalpha1.jpg" align="middle" height="300px"/>
                </td>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="bair37_to_bair_meanalpha1.jpg" align="middle" height="300px"/>
                </td>
            </tr>
        </table>
    </div>

    <h4 align="middle">Morph My Face and BAIR Mean Face</h4>
    <div align="middle">
        <table>
            <tr>
                <td>
                    <figcaption align="middle">morph me into bair</figcaption>
                    <img src="zzx_to_bair_meanalpha1.jpg" align="middle" height="300px"/>
                </td>
                <td>
                    <figcaption align="middle">morph bair into me</figcaption>
                    <img src="bair_mean_to_zzxalpha1.jpg" align="middle" height="300px"/>
                </td>
            </tr>
        </table>
    </div>

    <h2 align="middle">
        Part 5: Caricatures: Extrapolating From The Mean
    </h2>
    <p>The normal range of alpha is between 0 and 1, and with alpha value 0.5, the produced image is 
        the mean face of the two faces. In this part, I explore the effect when alpha is within abnormal
        range.
    </p>
    <div align="middle">
        <table>
            <tr>
                <td>
                    <figcaption align="middle">oringin</figcaption>
                    <img src="zzx_to_bair_meanalpha0.jpg".jpg" align="middle" height="300px"/>
                </td>
                <td>
                    <figcaption align="middle">alpha = 0.5</figcaption>
                    <img src="zzx_to_bair_meanalpha0.5.jpg".jpg" align="middle" height="300px"/>
                </td>
                <td>
                    <figcaption align="middle">alpha = -0.5</figcaption>
                    <img src="zzx_to_bair_meanalpha-0.5.jpg" align="middle" height="300px"/>
                </td>
            </tr>
        </table>
    </div>
    <br><br>
    <h2  align="middle">
        Part 6: Bells and Whistles I
    </h2 >
    <h4 align="middle">Change "Gender" of Face</h4>
    <p>I use the average face of male & female, create the difference of female face and male face. 
        Since we believe that faces form high dimensional spaces, the difference of male and female face 
        can be essentially understood and used as difference between a face's male and female "versions".
    </p>

    <div align="middle">
        <table>
            <tr>
                <td>
                    <figcaption align="middle">Average Male</figcaption>
                    <img src="male.jpg" align="middle" height="300px"/>
                </td>
                <td>
                    <figcaption align="middle">Average Female</figcaption>
                    <img src="female.jpg".jpg" align="middle" height="300px"/>
                </td>
            </tr>
        </table>
    </div>
    
    <p>By just applying the shape difference to my face or just applying the color differnce, I create
        my face with female shape and color. I also create the face with both 
        shape and color difference applied.
    </p>
    <p>When computing difference of color, I morph the male face into female shape before compute the
        difference of pixel value, to make sure that shape difference does not interfere with color difference.
    </p>
    <p>It is visible that after applying the color difference, my face seems whiter, and with shape difference
        my face becomes skinnier
    </p>

    <div align="middle">
        <table>
            <tr>
                <td>
                    <figcaption align="middle">Oringinal Face</figcaption>
                    <img src="zzx.jpg" align="middle" height="300px"/>
                </td>
                <td>
                    <figcaption align="middle">Only Color Changed</figcaption>
                    <img src="tofemale/female_zzx_color.jpg" align="middle" height="300px"/>
                </td>
            </tr>
        </table>
    </div>
    <div align="middle">
        <table>
            <tr>
                <td>
                    <figcaption align="middle">Only Shape Changed</figcaption>
                    <img src="tofemale/female_zzx_shape.jpg" align="middle" height="300px"/>
                </td>
                <td>
                    <figcaption align="middle">Both Color & Shape Changed</figcaption>
                    <img src="tofemale/female_zzx_both.jpg" align="middle" height="300px"/>
                </td>
            </tr>
        </table>
    </div>

    <br><br>
    <h2  align="middle">
        Part 7: Bells and Whistles II
    </h2 >
    <h4 align="middle">Morphing Music Video On A Theme</h4>
    <p>I create a morphing video of the faces of my favorite soccer club's starting 11 players.
    </p>


    <iframe width="800" height="500" src="https://www.youtube.com/embed/AuEBpMufwkQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

    <br><br>
    <h2  align="middle">
        Part 7: Bells and Whistles III
    </h2 >
    <h4 align="middle">Morphing Music Video of Students in the Class</h4>
    <p align="middle">My face (Number 0) to next Yihui's face (Number 1)
    </p>
    <div align="middle">
        <table>
            <tr>
                <td>
                    <figcaption align="middle"></figcaption>
                    <img src="0_1.gif" align="middle" height="300px"/>
                </td>
            </tr>
        </table>
    </div>
    <h4 align="middle"> Final Video</h4 align="middle">
    <iframe width="800" height="500" src="https://www.youtube.com/embed/O2p-U615Rzs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>





    
    <br><br><br>
</body>
</html>